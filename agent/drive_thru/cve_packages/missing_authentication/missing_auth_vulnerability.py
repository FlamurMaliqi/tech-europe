"""
CVE-2024-0006: Missing Authentication Vulnerability
VULNERABLE: No authentication required for admin functions
Severity: High
DO NOT USE IN PRODUCTION - FOR EDUCATIONAL PURPOSES ONLY
"""

from datetime import datetime
from typing import Dict, Any, List


class MissingAuthenticationVulnerability:
    """VULNERABLE: Missing authentication vulnerability implementation for lab purposes"""
    
    def __init__(self):
        self.vulnerability_type = "Missing Authentication"
        self.cve_id = "CVE-2024-0006"
        self.severity = "High"
        self.description = "No authentication required for admin functions"
    
    def vulnerable_admin_unlock(self) -> Dict[str, Any]:
        """
        VULNERABLE: Admin unlock endpoint without authentication
        
        This method demonstrates a missing authentication vulnerability
        where admin functions are accessible without proper authentication.
        
        Returns:
            Dictionary with unlock result
            
        Security Issues:
            - No authentication required for admin functions
            - Anyone can access admin endpoints
            - No authorization checks
        """
        # VULNERABLE: No authentication required for admin functions
        # This endpoint should require proper authentication
        
        return {
            "status": "unlocked",
            "message": "System unlocked successfully",
            "timestamp": datetime.utcnow().isoformat(),
            "warning": "VULNERABLE: No authentication required for admin unlock"
        }
    
    def vulnerable_admin_get_users(self) -> Dict[str, Any]:
        """
        VULNERABLE: Admin endpoint to get all users without authentication
        
        Returns:
            Dictionary with user list
        """
        # VULNERABLE: No authentication required for admin functions
        # This should require proper admin authentication
        
        # Mock user data
        users = [
            {"id": 1, "username": "admin", "email": "admin@example.com"},
            {"id": 2, "username": "user1", "email": "user1@example.com"},
            {"id": 3, "username": "user2", "email": "user2@example.com"}
        ]
        
        return {
            "users": users,
            "count": len(users),
            "warning": "VULNERABLE: No authentication required for admin endpoint"
        }
    
    def vulnerable_admin_delete_user(self, user_id: int) -> Dict[str, Any]:
        """
        VULNERABLE: Admin endpoint to delete user without authentication
        
        Args:
            user_id: ID of user to delete
            
        Returns:
            Dictionary with deletion result
        """
        # VULNERABLE: No authentication required for admin functions
        # This should require proper admin authentication
        
        return {
            "status": "deleted",
            "user_id": user_id,
            "message": f"User {user_id} deleted successfully",
            "timestamp": datetime.utcnow().isoformat(),
            "warning": "VULNERABLE: No authentication required for admin delete operation"
        }
    
    def vulnerable_admin_system_restart(self) -> Dict[str, Any]:
        """
        VULNERABLE: Admin endpoint to restart system without authentication
        
        Returns:
            Dictionary with restart result
        """
        # VULNERABLE: No authentication required for system operations
        # This should require proper admin authentication
        
        return {
            "status": "restarting",
            "message": "System restart initiated",
            "timestamp": datetime.utcnow().isoformat(),
            "warning": "VULNERABLE: No authentication required for system restart"
        }
    
    def vulnerable_admin_execute_command(self, command: str) -> Dict[str, Any]:
        """
        VULNERABLE: Admin endpoint to execute commands without authentication
        
        Args:
            command: Command to execute
            
        Returns:
            Dictionary with command execution result
        """
        # VULNERABLE: No authentication required for command execution
        # This should require proper admin authentication
        
        return {
            "status": "executed",
            "command": command,
            "timestamp": datetime.utcnow().isoformat(),
            "warning": "VULNERABLE: No authentication required for command execution"
        }


# Global instance for easy import
missing_authentication_vulnerability = MissingAuthenticationVulnerability()
